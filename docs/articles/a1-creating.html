<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1. Creating and manipulating frequency tables • vcdExtra</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1. Creating and manipulating frequency tables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vcdExtra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8-7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a1-creating.html">1. Creating and manipulating frequency tables</a></li>
    <li><a class="dropdown-item" href="../articles/a2-tests.html">2. Tests of Independence</a></li>
    <li><a class="dropdown-item" href="../articles/a3-loglinear.html">3. Loglinear Models</a></li>
    <li><a class="dropdown-item" href="../articles/a4-mosaics.html">4. Mosaic plots</a></li>
    <li><a class="dropdown-item" href="../articles/a5-demo-housing.html">5. Demo - Housing Data</a></li>
    <li><a class="dropdown-item" href="../articles/a6-mobility.html">6. Mobility tables</a></li>
    <li><a class="dropdown-item" href="../articles/a7-continuous.html">7. Continuous predictors</a></li>
    <li><a class="dropdown-item" href="../articles/datasets.html">Datasets for categorical data analysis</a></li>
    <li><a class="dropdown-item" href="../articles/tidyCats.html">tidyCat: Tidy Methods For Categorical Data Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/friendly/vcdExtra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>1. Creating and manipulating frequency tables</h1>
                        <h4 data-toc-skip class="author">Michael
Friendly</h4>
            
            <h4 data-toc-skip class="date">2025-12-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/friendly/vcdExtra/blob/HEAD/vignettes/a1-creating.Rmd" class="external-link"><code>vignettes/a1-creating.Rmd</code></a></small>
      <div class="d-none name"><code>a1-creating.Rmd</code></div>
    </div>

    
    
<p>R provides many methods for creating frequency and contingency
tables. Several are described below. In the examples below, we use some
real examples and some anonymous ones, where the variables
<code>A</code>, <code>B</code>, and <code>C</code> represent categorical
variables, and <code>X</code> represents an arbitrary R data object.</p>
<div class="section level3">
<h3 id="forms-of-frequency-data">Forms of frequency data<a class="anchor" aria-label="anchor" href="#forms-of-frequency-data"></a>
</h3>
<p>The first thing you need to know is that categorical data can be
represented in three different forms in R, and it is sometimes necessary
to convert from one form to another, for carrying out statistical tests,
fitting models or visualizing the results. Once a data object exists in
R, you can examine its complete structure with the <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code>
function, or view the names of its components with the
<code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code> function.</p>
<div class="section level4">
<h4 id="case-form">Case form<a class="anchor" aria-label="anchor" href="#case-form"></a>
</h4>
<p>Categorical data in case form are simply data frames containing
individual observations, with one or more factors, used as the
classifying variables. In case form, there may also be numeric
covariates. The total number of observations is <code>nrow(X)</code>,
and the number of variables is <code>ncol(X)</code>.</p>
<p><strong><em>Example</em></strong>:</p>
<p>The <code>Arthritis</code> data is available in case form in the
<code>vcd</code> package. There are two explanatory factors:
<code>Treatment</code> and <code>Sex</code>. <code>Age</code> is a
numeric covariate, and <code>Improved</code> is the response— an ordered
factor, with levels None &lt; Some &lt; Marked. Excluding
<code>Age</code>, this represents a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2 \times 2 \times 3</annotation></semantics></math>
contingency table for <code>Treatment</code>, <code>Sex</code> and
<code>Improved</code>, but in case form.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Arthritis</span><span class="op">)</span>      <span class="co"># show the variables</span></span>
<span><span class="co">## [1] "ID"        "Treatment" "Sex"       "Age"       "Improved"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Arthritis</span><span class="op">)</span>        <span class="co"># show the structure</span></span>
<span><span class="co">## 'data.frame':    84 obs. of  5 variables:</span></span>
<span><span class="co">##  $ ID       : int  57 46 77 17 36 23 75 39 33 55 ...</span></span>
<span><span class="co">##  $ Treatment: Factor w/ 2 levels "Placebo","Treated": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ Sex      : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ Age      : int  27 29 30 32 46 58 59 59 63 63 ...</span></span>
<span><span class="co">##  $ Improved : Ord.factor w/ 3 levels "None"&lt;"Some"&lt;..: 2 1 1 3 3 3 1 3 1 1 ...</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Arthritis</span>,<span class="fl">5</span><span class="op">)</span>     <span class="co"># first 5 observations, same as Arthritis[1:5,] </span></span>
<span><span class="co">##   ID Treatment  Sex Age Improved</span></span>
<span><span class="co">## 1 57   Treated Male  27     Some</span></span>
<span><span class="co">## 2 46   Treated Male  29     None</span></span>
<span><span class="co">## 3 77   Treated Male  30     None</span></span>
<span><span class="co">## 4 17   Treated Male  32   Marked</span></span>
<span><span class="co">## 5 36   Treated Male  46   Marked</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="frequency-form">Frequency form<a class="anchor" aria-label="anchor" href="#frequency-form"></a>
</h4>
<p>Data in frequency form is also a data frame containing one or more
factors, and a frequency variable, often called <code>Freq</code> or
<code>count</code>. The total number of observations is:
<code>sum(X$Freq)</code>, <code>sum(X[,"Freq"])</code> or some
equivalent form.</p>
<p>The number of cells in the table is given by
<code>nrow(X)</code>.</p>
<p><strong><em>Example</em></strong>: For small frequency tables, it is
often convenient to enter them in frequency form using
<code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code> for the factors and <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> to list
the counts in a vector. The example below, from <span class="citation">(Agresti, 2002)</span> gives results for the 1991
General Social Survey, with respondents classified by sex and party
identification.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Agresti (2002), table 3.11, p. 106</span></span>
<span><span class="va">GSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span>, </span>
<span>              party <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem"</span>, <span class="st">"indep"</span>, <span class="st">"rep"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">279</span>,<span class="fl">165</span>,<span class="fl">73</span>,<span class="fl">47</span>,<span class="fl">225</span>,<span class="fl">191</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">GSS</span></span>
<span><span class="co">##      sex party count</span></span>
<span><span class="co">## 1 female   dem   279</span></span>
<span><span class="co">## 2   male   dem   165</span></span>
<span><span class="co">## 3 female indep    73</span></span>
<span><span class="co">## 4   male indep    47</span></span>
<span><span class="co">## 5 female   rep   225</span></span>
<span><span class="co">## 6   male   rep   191</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">GSS</span><span class="op">)</span></span>
<span><span class="co">## [1] "sex"   "party" "count"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GSS</span><span class="op">)</span></span>
<span><span class="co">## 'data.frame':    6 obs. of  3 variables:</span></span>
<span><span class="co">##  $ sex  : Factor w/ 2 levels "female","male": 1 2 1 2 1 2</span></span>
<span><span class="co">##  $ party: Factor w/ 3 levels "dem","indep",..: 1 1 2 2 3 3</span></span>
<span><span class="co">##  $ count: num  279 165 73 47 225 191</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">GSS</span><span class="op">$</span><span class="va">count</span><span class="op">)</span></span>
<span><span class="co">## [1] 980</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="table-form">Table form<a class="anchor" aria-label="anchor" href="#table-form"></a>
</h4>
<p>Table form data is represented by a <code>matrix</code>,
<code>array</code> or <code>table</code> object, whose elements are the
frequencies in an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>-way
table. The variable names (factors) and their levels are given by
<code>dimnames(X)</code>. The total number of observations is
<code>sum(X)</code>. The number of dimensions of the table is
<code>length(dimnames(X))</code>, and the table sizes are given by
<code>sapply(dimnames(X), length)</code>.</p>
<p><strong><em>Example</em></strong>: The <code>HairEyeColor</code> is
stored in table form in <code>vcd</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">HairEyeColor</span><span class="op">)</span>                      <span class="co"># show the structure</span></span>
<span><span class="co">##  'table' num [1:4, 1:4, 1:2] 32 53 10 3 11 50 10 30 10 25 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 3</span></span>
<span><span class="co">##   ..$ Hair: chr [1:4] "Black" "Brown" "Red" "Blond"</span></span>
<span><span class="co">##   ..$ Eye : chr [1:4] "Brown" "Blue" "Hazel" "Green"</span></span>
<span><span class="co">##   ..$ Sex : chr [1:2] "Male" "Female"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">HairEyeColor</span><span class="op">)</span>                      <span class="co"># number of cases</span></span>
<span><span class="co">## [1] 592</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">HairEyeColor</span><span class="op">)</span>, <span class="va">length</span><span class="op">)</span> <span class="co"># table dimension sizes</span></span>
<span><span class="co">## Hair  Eye  Sex </span></span>
<span><span class="co">##    4    4    2</span></span></code></pre></div>
<p><strong><em>Example</em></strong>: Enter frequencies in a matrix, and
assign <code>dimnames</code>, giving the variable names and category
labels. Note that, by default, <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix()</a></code> uses the elements
supplied by <em>columns</em> in the result, unless you specify
<code>byrow=TRUE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A 4 x 4 table  Agresti (2002, Table 2.8, p. 57) Job Satisfaction</span></span>
<span><span class="va">JobSat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span>, </span>
<span>                    <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">1</span>, </span>
<span>                   <span class="fl">10</span>,<span class="fl">10</span>,<span class="fl">14</span>, <span class="fl">9</span>, </span>
<span>                    <span class="fl">6</span>, <span class="fl">7</span>,<span class="fl">12</span>,<span class="fl">11</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">JobSat</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt; 15k"</span>, <span class="st">"15-25k"</span>, <span class="st">"25-40k"</span>, <span class="st">"&gt; 40k"</span><span class="op">)</span>,</span>
<span>  satisfaction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VeryD"</span>, <span class="st">"LittleD"</span>, <span class="st">"ModerateS"</span>, <span class="st">"VeryS"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">JobSat</span></span>
<span><span class="co">##         satisfaction</span></span>
<span><span class="co">## income   VeryD LittleD ModerateS VeryS</span></span>
<span><span class="co">##   &lt; 15k      1       3        10     6</span></span>
<span><span class="co">##   15-25k     2       3        10     7</span></span>
<span><span class="co">##   25-40k     1       6        14    12</span></span>
<span><span class="co">##   &gt; 40k      0       1         9    11</span></span></code></pre></div>
<p><code>JobSat</code> is a <strong>matrix</strong>, not an object of
<code>class("table")</code>, and some functions are happier with tables
than matrices. You can coerce it to a table with
<code><a href="https://rdrr.io/r/base/table.html" class="external-link">as.table()</a></code>,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">JobSat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.table</a></span><span class="op">(</span><span class="va">JobSat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">JobSat</span><span class="op">)</span></span>
<span><span class="co">##  'table' num [1:4, 1:4] 1 2 1 0 3 3 6 1 10 10 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ income      : chr [1:4] "&lt; 15k" "15-25k" "25-40k" "&gt; 40k"</span></span>
<span><span class="co">##   ..$ satisfaction: chr [1:4] "VeryD" "LittleD" "ModerateS" "VeryS"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="sec:ordered-factors">Ordered factors and reordered tables<a class="anchor" aria-label="anchor" href="#sec:ordered-factors"></a>
</h3>
<p>In table form, the values of the table factors are ordered by their
position in the table. Thus in the <code>JobSat</code> data, both
<code>income</code> and <code>satisfaction</code> represent ordered
factors, and the <em>positions</em> of the values in the rows and
columns reflects their ordered nature.</p>
<p>Yet, for analysis, there are times when you need <em>numeric</em>
values for the levels of ordered factors in a table, e.g., to treat a
factor as a quantitative variable. In such cases, you can simply
re-assign the <code>dimnames</code> attribute of the table variables.
For example, here, we assign numeric values to <code>income</code> as
the middle of their ranges, and treat <code>satisfaction</code> as
equally spaced with integer scores.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">JobSat</span><span class="op">)</span><span class="op">$</span><span class="va">income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.5</span>,<span class="fl">20</span>,<span class="fl">32.5</span>,<span class="fl">60</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">JobSat</span><span class="op">)</span><span class="op">$</span><span class="va">satisfaction</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span></code></pre></div>
<p>For the <code>HairEyeColor</code> data, hair color and eye color are
ordered arbitrarily. For visualizing the data using mosaic plots and
other methods described below, it turns out to be more useful to assure
that both hair color and eye color are ordered from dark to light. Hair
colors are actually ordered this way already, and it is easiest to
re-order eye colors by indexing. Again <code><a href="https://rdrr.io/r/utils/str.html" class="external-link">str()</a></code> is your
friend.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HairEyeColor</span> <span class="op">&lt;-</span> <span class="va">HairEyeColor</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">HairEyeColor</span><span class="op">)</span></span>
<span><span class="co">##  'table' num [1:4, 1:4, 1:2] 32 53 10 3 10 25 7 5 3 15 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 3</span></span>
<span><span class="co">##   ..$ Hair: chr [1:4] "Black" "Brown" "Red" "Blond"</span></span>
<span><span class="co">##   ..$ Eye : chr [1:4] "Brown" "Hazel" "Green" "Blue"</span></span>
<span><span class="co">##   ..$ Sex : chr [1:2] "Male" "Female"</span></span></code></pre></div>
<p>This is also the order for both hair color and eye color shown in the
result of a correspondence analysis (<span class="citation">(<strong>ref?</strong>)</span>(fig:ca-haireye)
below.</p>
<p>With data in case form or frequency form, when you have ordered
factors represented with character values, you must ensure that they are
treated as ordered in R.
<!-- \footnote{In SAS, many procedures offer the option -->
<!--    `order = data | internal | formatted` to allow character values -->
<!--    to be ordered according to (a) their order in the data set, (b) -->
<!--    sorted internal value, or (c) sorted formatted representation -->
<!--    provided by a SAS format. --> <!-- } --></p>
<p>Imagine that the <code>Arthritis</code> data was read from a text
file.<br>
By default the <code>Improved</code> will be ordered alphabetically:
<code>Marked</code>, <code>None</code>, <code>Some</code> — not what we
want. In this case, the function <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered()</a></code> (and others) can
be useful.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Arthritis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"arthritis.txt"</span>,header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Arthritis</span><span class="op">$</span><span class="va">Improved</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">Arthritis</span><span class="op">$</span><span class="va">Improved</span>, </span>
<span>                              levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"None"</span>, <span class="st">"Some"</span>, <span class="st">"Marked"</span><span class="op">)</span></span>
<span>                              <span class="op">)</span></span></code></pre></div>
<p>The dataset <code>Arthritis</code> in the <code>vcd</code> package is
a data.frame in this form With this order of <code>Improved</code>, the
response in this data, a mosaic display of <code>Treatment</code> and
<code>Improved</code> (<span class="citation">(<strong>ref?</strong>)</span>(fig:arthritis) shows a
clearly interpretable pattern.</p>
<p>The original version of <code>mosaic</code> in the <code>vcd</code>
package required the input to be a contingency table in array form, so
we convert using <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>.</p>
<!-- ```{r Arthritis, height=6, width=7, fig.cap="Mosaic plot for the `Arthritis` data ..."} -->
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Arthritis</span>, package<span class="op">=</span><span class="st">"vcd"</span><span class="op">)</span></span>
<span><span class="va">art</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="op">~</span><span class="va">Treatment</span> <span class="op">+</span> <span class="va">Improved</span>, data <span class="op">=</span> <span class="va">Arthritis</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/mosaic.html" class="external-link">mosaic</a></span><span class="op">(</span><span class="va">art</span>, gp <span class="op">=</span> <span class="va">shading_max</span>, split_vertical <span class="op">=</span> <span class="cn">TRUE</span>, main<span class="op">=</span><span class="st">"Arthritis: [Treatment] [Improved]"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="a1-creating_files/figure-html/Arthritis-1.png" class="r-plt" alt="Mosaic plot for the `Arthritis` data, showing the marginal model of independence for Treatment and Improved.  Age, a covariate, and Sex are ignored here." width="576"><p class="caption">
Mosaic plot for the <code>Arthritis</code> data, showing the marginal
model of independence for Treatment and Improved. Age, a covariate, and
Sex are ignored here.
</p>
</div>
<p>Several data sets in the package illustrate the salutary effects of
reordering factor levels in mosaic displays and other analyses. See:</p>
<ul>
<li><code><a href="../reference/AirCrash.html">help(AirCrash)</a></code></li>
<li><code><a href="../reference/Glass.html">help(Glass)</a></code></li>
<li><code><a href="../reference/HouseTasks.html">help(HouseTasks)</a></code></li>
</ul>
<p>The <a href="https://CRAN.R-project.org/package=seriation" class="external-link">seriate</a> package
now contains a general method to permute the row and column variables in
a table according to the result of a correspondence analysis, using
scores on the first CA dimension.</p>
<div class="section level4">
<h4 id="re-ordering-dimensions">Re-ordering dimensions<a class="anchor" aria-label="anchor" href="#re-ordering-dimensions"></a>
</h4>
<p>Finally, there are situations where, particularly for display
purposes, you want to re-order the <em>dimensions</em> of an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>-way
table, or change the labels for the variables or levels. This is easy
when the data are in table form: <code><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm()</a></code> permutes the
dimensions, and assigning to <code>names</code> and
<code>dimnames</code> changes variable names and level labels
respectively. We will use the following version of
<code>UCBAdmissions</code> in @ref(sec:mantel) below. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Changing &lt;code&gt;Admit&lt;/code&gt; to &lt;code&gt;Admit?&lt;/code&gt; might
be useful for display purposes, but is dangerous— because it is then
difficult to use that variable name in a model formula. See
@ref(sec:tips) for options &lt;code&gt;labeling_args&lt;/code&gt; and
&lt;code&gt;set_labels&lt;/code&gt;to change variable and level names for displays
in the &lt;code&gt;strucplot&lt;/code&gt; framework.&lt;/p&gt;"><sup>1</sup></a></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">UCB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span><span class="va">UCBAdmissions</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">UCB</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Yes"</span>, <span class="st">"No"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">UCB</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sex"</span>, <span class="st">"Admit?"</span>, <span class="st">"Department"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># display as a flattened table</span></span>
<span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable</a></span><span class="op">(</span><span class="va">UCB</span><span class="op">)</span></span>
<span><span class="co">##               Department   A   B   C   D   E   F</span></span>
<span><span class="co">## Sex    Admit?                                   </span></span>
<span><span class="co">## Male   Yes               512 353 120 138  53  22</span></span>
<span><span class="co">##        No                313 207 205 279 138 351</span></span>
<span><span class="co">## Female Yes                89  17 202 131  94  24</span></span>
<span><span class="co">##        No                 19   8 391 244 299 317</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="sec:structable">
<code>structable()</code><a class="anchor" aria-label="anchor" href="#sec:structable"></a>
</h3>
<p>For 3-way and larger tables the <code><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable()</a></code> function in
<code>vcd</code> provides a convenient and flexible tabular display. The
variables assigned to the rows and columns of a two-way display can be
specified by a model formula.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">HairEyeColor</span><span class="op">)</span>                   <span class="co"># show the table: default</span></span>
<span><span class="co">##              Eye Brown Hazel Green Blue</span></span>
<span><span class="co">## Hair  Sex                              </span></span>
<span><span class="co">## Black Male          32    10     3   11</span></span>
<span><span class="co">##       Female        36     5     2    9</span></span>
<span><span class="co">## Brown Male          53    25    15   50</span></span>
<span><span class="co">##       Female        66    29    14   34</span></span>
<span><span class="co">## Red   Male          10     7     7   10</span></span>
<span><span class="co">##       Female        16     7     7    7</span></span>
<span><span class="co">## Blond Male           3     5     8   30</span></span>
<span><span class="co">##       Female         4     5     8   64</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">Hair</span><span class="op">+</span><span class="va">Sex</span> <span class="op">~</span> <span class="va">Eye</span>, <span class="va">HairEyeColor</span><span class="op">)</span>   <span class="co"># specify col ~ row variables</span></span>
<span><span class="co">##       Hair Black        Brown         Red        Blond       </span></span>
<span><span class="co">##       Sex   Male Female  Male Female Male Female  Male Female</span></span>
<span><span class="co">## Eye                                                          </span></span>
<span><span class="co">## Brown         32     36    53     66   10     16     3      4</span></span>
<span><span class="co">## Hazel         10      5    25     29    7      7     5      5</span></span>
<span><span class="co">## Green          3      2    15     14    7      7     8      8</span></span>
<span><span class="co">## Blue          11      9    50     34   10      7    30     64</span></span></code></pre></div>
<p>It also returns an object of class <code>"structable"</code> which
may be plotted with <code><a href="https://rdrr.io/pkg/vcd/man/mosaic.html" class="external-link">mosaic()</a></code> (not shown here).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HSE</span> <span class="op">&lt;</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">Hair</span><span class="op">+</span><span class="va">Sex</span> <span class="op">~</span> <span class="va">Eye</span>, <span class="va">HairEyeColor</span><span class="op">)</span>   <span class="co"># save structable object</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/mosaic.html" class="external-link">mosaic</a></span><span class="op">(</span><span class="va">HSE</span><span class="op">)</span>                                        <span class="co"># plot it</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sec:table">
<code>table()</code> and friends<a class="anchor" aria-label="anchor" href="#sec:table"></a>
</h3>
<p>You can generate frequency tables from factor variables using the
<code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> function, tables of proportions using the
<code><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table()</a></code> function, and marginal frequencies using
<code><a href="https://rdrr.io/r/base/marginSums.html" class="external-link">margin.table()</a></code>.</p>
<p>For these examples, create some categorical vectors:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">n</span><span class="op">=</span><span class="fl">500</span></span>
<span> <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a1"</span>,<span class="st">"a2"</span><span class="op">)</span>, <span class="va">n</span>, rep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b1"</span>,<span class="st">"b2"</span><span class="op">)</span>, <span class="va">n</span>, rep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"c1"</span>,<span class="st">"c2"</span><span class="op">)</span>, <span class="va">n</span>, rep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">A</span>,<span class="va">B</span>,<span class="va">C</span><span class="op">)</span></span></code></pre></div>
<p>These lines illustrate <code>table</code>-related functions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2-Way Frequency Table</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span><span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">A</span>,<span class="va">B</span><span class="op">)</span>   <span class="co"># A will be rows, B will be columns</span></span>
<span><span class="va">mytable</span>                 <span class="co"># print table</span></span>
<span><span class="co">##     B</span></span>
<span><span class="co">## A     b1  b2</span></span>
<span><span class="co">##   a1 116 114</span></span>
<span><span class="co">##   a2 138 132</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/marginSums.html" class="external-link">margin.table</a></span><span class="op">(</span><span class="va">mytable</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># A frequencies (summed over B)</span></span>
<span><span class="co">## A</span></span>
<span><span class="co">##  a1  a2 </span></span>
<span><span class="co">## 230 270</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/marginSums.html" class="external-link">margin.table</a></span><span class="op">(</span><span class="va">mytable</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># B frequencies (summed over A)</span></span>
<span><span class="co">## B</span></span>
<span><span class="co">##  b1  b2 </span></span>
<span><span class="co">## 254 246</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span>    <span class="co"># cell percentages</span></span>
<span><span class="co">##     B</span></span>
<span><span class="co">## A       b1    b2</span></span>
<span><span class="co">##   a1 0.232 0.228</span></span>
<span><span class="co">##   a2 0.276 0.264</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="va">mytable</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># row percentages</span></span>
<span><span class="co">##     B</span></span>
<span><span class="co">## A           b1        b2</span></span>
<span><span class="co">##   a1 0.5043478 0.4956522</span></span>
<span><span class="co">##   a2 0.5111111 0.4888889</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="va">mytable</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># column percentages</span></span>
<span><span class="co">##     B</span></span>
<span><span class="co">## A           b1        b2</span></span>
<span><span class="co">##   a1 0.4566929 0.4634146</span></span>
<span><span class="co">##   a2 0.5433071 0.5365854</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> can also generate multidimensional tables based
on 3 or more categorical variables. In this case, you can use the
<code><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable()</a></code> or <code><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable()</a></code> function to print the
results more attractively.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3-Way Frequency Table</span></span>
<span><span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">C</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable</a></span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span></span>
<span><span class="co">##       C c1 c2</span></span>
<span><span class="co">## A  B         </span></span>
<span><span class="co">## a1 b1   45 71</span></span>
<span><span class="co">##    b2   59 55</span></span>
<span><span class="co">## a2 b1   62 76</span></span>
<span><span class="co">##    b2   76 56</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> ignores missing values by default. To include
<code>NA</code> as a category in counts, include the table option
<code>exclude=NULL</code> if the variable is a vector. If the variable
is a factor you have to create a new factor using .</p>
</div>
<div class="section level3">
<h3 id="sec:xtabs">
<code>xtabs()</code><a class="anchor" aria-label="anchor" href="#sec:xtabs"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code> function allows you to create
cross-tabulations of data using formula style input. This typically
works with case-form data supplied in a data frame or a matrix. The
result is a contingency table in array format, whose dimensions are
determined by the terms on the right side of the formula.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3-Way Frequency Table</span></span>
<span><span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="op">~</span><span class="va">A</span><span class="op">+</span><span class="va">B</span><span class="op">+</span><span class="va">C</span>, data<span class="op">=</span><span class="va">mydata</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable</a></span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span>    <span class="co"># print table</span></span>
<span><span class="co">##       C c1 c2</span></span>
<span><span class="co">## A  B         </span></span>
<span><span class="co">## a1 b1   45 71</span></span>
<span><span class="co">##    b2   59 55</span></span>
<span><span class="co">## a2 b1   62 76</span></span>
<span><span class="co">##    b2   76 56</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span>   <span class="co"># chi-square test of indepedence</span></span>
<span><span class="co">## Call: xtabs(formula = ~A + B + C, data = mydata)</span></span>
<span><span class="co">## Number of cases in table: 500 </span></span>
<span><span class="co">## Number of factors: 3 </span></span>
<span><span class="co">## Test for independence of all factors:</span></span>
<span><span class="co">##  Chisq = 9.888, df = 4, p-value = 0.04235</span></span></code></pre></div>
<p>If a variable is included on the left side of the formula, it is
assumed to be a vector of frequencies (useful if the data have already
been tabulated in frequency form).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">GSStab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">party</span>, data<span class="op">=</span><span class="va">GSS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##         party</span></span>
<span><span class="co">## sex      dem indep rep</span></span>
<span><span class="co">##   female 279    73 225</span></span>
<span><span class="co">##   male   165    47 191</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">GSStab</span><span class="op">)</span></span>
<span><span class="co">## Call: xtabs(formula = count ~ sex + party, data = GSS)</span></span>
<span><span class="co">## Number of cases in table: 980 </span></span>
<span><span class="co">## Number of factors: 2 </span></span>
<span><span class="co">## Test for independence of all factors:</span></span>
<span><span class="co">##  Chisq = 7.01, df = 2, p-value = 0.03005</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="collapsing-over-table-factors-aggregate-margin-table-and-apply">Collapsing over table factors: <code>aggregate()</code>,
<code>margin.table()</code> and <code>apply()</code><a class="anchor" aria-label="anchor" href="#collapsing-over-table-factors-aggregate-margin-table-and-apply"></a>
</h3>
<p>It sometimes happens that we have a data set with more variables or
factors than we want to analyse, or else, having done some initial
analyses, we decide that certain factors are not important, and so
should be excluded from graphic displays by collapsing (summing) over
them. For example, mosaic plots and fourfold displays are often simpler
to construct from versions of the data collapsed over the factors which
are not shown in the plots.</p>
<p>The appropriate tools to use again depend on the form in which the
data are represented— a case-form data frame, a frequency-form data
frame (<code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code>), or a table-form array or table object
(<code><a href="https://rdrr.io/r/base/marginSums.html" class="external-link">margin.table()</a></code> or <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code>).</p>
<p>When the data are in frequency form, and we want to produce another
frequency data frame, <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> is a handy tool, using
the argument <code>FUN=sum</code> to sum the frequency variable over the
factors <em>not</em> mentioned in the formula.</p>
<p><strong><em>Example</em></strong>: The data frame
<code>DaytonSurvey</code> in the <code>vcdExtra</code> package
represents a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>2</mn><mn>5</mn></msup><annotation encoding="application/x-tex">2^5</annotation></semantics></math>
table giving the frequencies of reported use (``ever used?’’) of
alcohol, cigarettes and marijuana in a sample of high school seniors,
also classified by sex and race.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"DaytonSurvey"</span>, package<span class="op">=</span><span class="st">"vcdExtra"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">DaytonSurvey</span><span class="op">)</span></span>
<span><span class="co">## 'data.frame':    32 obs. of  6 variables:</span></span>
<span><span class="co">##  $ cigarette: Factor w/ 2 levels "Yes","No": 1 2 1 2 1 2 1 2 1 2 ...</span></span>
<span><span class="co">##  $ alcohol  : Factor w/ 2 levels "Yes","No": 1 1 2 2 1 1 2 2 1 1 ...</span></span>
<span><span class="co">##  $ marijuana: Factor w/ 2 levels "Yes","No": 1 1 1 1 2 2 2 2 1 1 ...</span></span>
<span><span class="co">##  $ sex      : Factor w/ 2 levels "female","male": 1 1 1 1 1 1 1 1 2 2 ...</span></span>
<span><span class="co">##  $ race     : Factor w/ 2 levels "white","other": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ Freq     : num  405 13 1 1 268 218 17 117 453 28 ...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">DaytonSurvey</span><span class="op">)</span></span>
<span><span class="co">##   cigarette alcohol marijuana    sex  race Freq</span></span>
<span><span class="co">## 1       Yes     Yes       Yes female white  405</span></span>
<span><span class="co">## 2        No     Yes       Yes female white   13</span></span>
<span><span class="co">## 3       Yes      No       Yes female white    1</span></span>
<span><span class="co">## 4        No      No       Yes female white    1</span></span>
<span><span class="co">## 5       Yes     Yes        No female white  268</span></span>
<span><span class="co">## 6        No     Yes        No female white  218</span></span></code></pre></div>
<p>To focus on the associations among the substances, we want to
collapse over sex and race. The right-hand side of the formula used in
the call to <code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code> gives the factors to be retained in
the new frequency data frame, <code>Dayton.ACM.df</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data in frequency form</span></span>
<span><span class="co"># collapse over sex and race</span></span>
<span><span class="va">Dayton.ACM.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">Freq</span> <span class="op">~</span> <span class="va">cigarette</span><span class="op">+</span><span class="va">alcohol</span><span class="op">+</span><span class="va">marijuana</span>, </span>
<span>                           data<span class="op">=</span><span class="va">DaytonSurvey</span>, </span>
<span>                           FUN<span class="op">=</span><span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">Dayton.ACM.df</span></span>
<span><span class="co">##   cigarette alcohol marijuana Freq</span></span>
<span><span class="co">## 1       Yes     Yes       Yes  911</span></span>
<span><span class="co">## 2        No     Yes       Yes   44</span></span>
<span><span class="co">## 3       Yes      No       Yes    3</span></span>
<span><span class="co">## 4        No      No       Yes    2</span></span>
<span><span class="co">## 5       Yes     Yes        No  538</span></span>
<span><span class="co">## 6        No     Yes        No  456</span></span>
<span><span class="co">## 7       Yes      No        No   43</span></span>
<span><span class="co">## 8        No      No        No  279</span></span></code></pre></div>
<p>When the data are in table form, and we want to produce another
table, <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code> with <code>FUN=sum</code> can be used in a
similar way to sum the table over dimensions not mentioned in the
<code>MARGIN</code> argument. <code><a href="https://rdrr.io/r/base/marginSums.html" class="external-link">margin.table()</a></code> is just a
wrapper for <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code> using the <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code>
function.</p>
<p><strong><em>Example</em></strong>: To illustrate, we first convert
the <code>DaytonSurvey</code> to a 5-way table using
<code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>, giving <code>Dayton.tab</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># in table form</span></span>
<span><span class="va">Dayton.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">Freq</span> <span class="op">~</span> <span class="va">cigarette</span><span class="op">+</span><span class="va">alcohol</span><span class="op">+</span><span class="va">marijuana</span><span class="op">+</span><span class="va">sex</span><span class="op">+</span><span class="va">race</span>, </span>
<span>                    data<span class="op">=</span><span class="va">DaytonSurvey</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">cigarette</span><span class="op">+</span><span class="va">alcohol</span><span class="op">+</span><span class="va">marijuana</span> <span class="op">~</span> <span class="va">sex</span><span class="op">+</span><span class="va">race</span>, </span>
<span>           data<span class="op">=</span><span class="va">Dayton.tab</span><span class="op">)</span></span>
<span><span class="co">##              cigarette Yes              No            </span></span>
<span><span class="co">##              alcohol   Yes      No     Yes      No    </span></span>
<span><span class="co">##              marijuana Yes  No Yes  No Yes  No Yes  No</span></span>
<span><span class="co">## sex    race                                           </span></span>
<span><span class="co">## female white           405 268   1  17  13 218   1 117</span></span>
<span><span class="co">##        other            23  23   0   1   2  19   0  12</span></span>
<span><span class="co">## male   white           453 228   1  17  28 201   1 133</span></span>
<span><span class="co">##        other            30  19   1   8   1  18   0  17</span></span></code></pre></div>
<p>Then, use <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply()</a></code> on <code>Dayton.tab</code> to give the
3-way table <code>Dayton.ACM.tab</code> summed over sex and race. The
elements in this new table are the column sums for
<code>Dayton.tab</code> shown by <code><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable()</a></code> just
above.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># collapse over sex and race</span></span>
<span><span class="va">Dayton.ACM.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Dayton.tab</span>, MARGIN<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, FUN<span class="op">=</span><span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">Dayton.ACM.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/marginSums.html" class="external-link">margin.table</a></span><span class="op">(</span><span class="va">Dayton.tab</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>   <span class="co"># same result</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">cigarette</span><span class="op">+</span><span class="va">alcohol</span> <span class="op">~</span> <span class="va">marijuana</span>, data<span class="op">=</span><span class="va">Dayton.ACM.tab</span><span class="op">)</span></span>
<span><span class="co">##           cigarette Yes      No    </span></span>
<span><span class="co">##           alcohol   Yes  No Yes  No</span></span>
<span><span class="co">## marijuana                          </span></span>
<span><span class="co">## Yes                 911   3  44   2</span></span>
<span><span class="co">## No                  538  43 456 279</span></span></code></pre></div>
<p>Many of these operations can be performed using the
<code>**ply()</code> functions in the <a href="https://CRAN.R-project.org/package=plyr" class="external-link"><code>plyr</code></a>
package. For example, with the data in a frequency form data frame, use
<code><a href="https://rdrr.io/pkg/plyr/man/ddply.html" class="external-link">ddply()</a></code> to collapse over unmentioned factors, and
<code><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">plyr::summarise()</a></code> as the function to be applied to each
piece. <!-- \footnote{ -->
<!-- Ugh. This `plyr` function clashes with a function of the same name in `vcdExtra`. -->
<!-- In this document I will use the explicit double-colon notation to keep them -->
<!-- separate. --> <!-- } --></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span></span>
<span><span class="va">Dayton.ACM.df</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html" class="external-link">ddply</a></span><span class="op">(</span><span class="va">DaytonSurvey</span>, </span>
<span>                             <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/quoted.html" class="external-link">.</a></span><span class="op">(</span><span class="va">cigarette</span>, <span class="va">alcohol</span>, <span class="va">marijuana</span><span class="op">)</span>, </span>
<span>                             <span class="fu">plyr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span>, Freq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Freq</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Dayton.ACM.df</span></span>
<span><span class="co">##   cigarette alcohol marijuana Freq</span></span>
<span><span class="co">## 1       Yes     Yes       Yes  911</span></span>
<span><span class="co">## 2       Yes     Yes        No  538</span></span>
<span><span class="co">## 3       Yes      No       Yes    3</span></span>
<span><span class="co">## 4       Yes      No        No   43</span></span>
<span><span class="co">## 5        No     Yes       Yes   44</span></span>
<span><span class="co">## 6        No     Yes        No  456</span></span>
<span><span class="co">## 7        No      No       Yes    2</span></span>
<span><span class="co">## 8        No      No        No  279</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="collapsing-table-levels-collapse-table">Collapsing table levels: <code>collapse.table()</code><a class="anchor" aria-label="anchor" href="#collapsing-table-levels-collapse-table"></a>
</h3>
<p>A related problem arises when we have a table or array and for some
purpose we want to reduce the number of levels of some factors by
summing subsets of the frequencies. For example, we may have initially
coded Age in 10-year intervals, and decide that, either for analysis or
display purposes, we want to reduce Age to 20-year intervals. The
<code><a href="../reference/collapse.table.html">collapse.table()</a></code> function in <code>vcdExtra</code> was
designed for this purpose.</p>
<p><strong><em>Example</em></strong>: Create a 3-way table, and collapse
Age from 10-year to 20-year intervals. First, we generate a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>6</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2 \times 6 \times 3</annotation></semantics></math>
table of random counts from a Poisson distribution with mean of 100.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create some sample data in frequency form</span></span>
<span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10-19"</span>, <span class="st">"20-29"</span>,  <span class="st">"30-39"</span>, <span class="st">"40-49"</span>, <span class="st">"50-59"</span>, <span class="st">"60-69"</span><span class="op">)</span></span>
<span><span class="va">education</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">'med'</span>, <span class="st">'high'</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>sex<span class="op">=</span><span class="va">sex</span>, age<span class="op">=</span><span class="va">age</span>, education<span class="op">=</span><span class="va">education</span><span class="op">)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">36</span>, <span class="fl">100</span><span class="op">)</span>   <span class="co"># random Possion cell frequencies</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">counts</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make it into a 3-way table</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">counts</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span></span>
<span><span class="co">##                  age 10-19 20-29 30-39 40-49 50-59 60-69</span></span>
<span><span class="co">## sex    education                                        </span></span>
<span><span class="co">## Male   low              98   105   104    90    90   101</span></span>
<span><span class="co">##        med              97   105   101    88    97   107</span></span>
<span><span class="co">##        high             99   101   109    88    99    96</span></span>
<span><span class="co">## Female low             102   117   101   105    85    88</span></span>
<span><span class="co">##        med             106    84    92   116   110    96</span></span>
<span><span class="co">##        high            106    96   121    91   107   102</span></span></code></pre></div>
<p>Now collapse <code>age</code> to 20-year intervals, and
<code>education</code> to 2 levels. In the arguments, levels of
<code>age</code> and <code>education</code> given the same label are
summed in the resulting smaller table.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># collapse age to 3 levels, education to 2 levels</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse.table.html">collapse.table</a></span><span class="op">(</span><span class="va">t1</span>, </span>
<span>         age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10-29"</span>, <span class="st">"10-29"</span>,  <span class="st">"30-49"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"50-69"</span><span class="op">)</span>,</span>
<span>         education<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;high"</span>, <span class="st">"&lt;high"</span>, <span class="st">"high"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span></span>
<span><span class="co">##                  age 10-29 30-49 50-69</span></span>
<span><span class="co">## sex    education                      </span></span>
<span><span class="co">## Male   &lt;high           405   383   395</span></span>
<span><span class="co">##        high            200   197   195</span></span>
<span><span class="co">## Female &lt;high           409   414   379</span></span>
<span><span class="co">##        high            202   212   209</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="collapsing-table-levels-dplyr">Collapsing table levels: <code>dplyr</code><a class="anchor" aria-label="anchor" href="#collapsing-table-levels-dplyr"></a>
</h3>
<p>For data sets in frequency form or case form, factor levels can be
collapsed by recoding the levels to some grouping. One handy function
for this is <code><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">dplyr::case_match()</a></code></p>
<p><strong><em>Example</em></strong>:</p>
<p>The <code><a href="../reference/Titanicp.html">vcdExtra::Titanicp</a></code> data set contains information on
1309 passengers on the <em>RMS Titanic</em>, including
<code>sibsp</code>, the number of (0:8) siblings or spouses aboard, and
<code>parch</code> (0:6), the number of parents or children aboard, but
the table is quite sparse.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Titanicp</span><span class="op">$</span><span class="va">sibsp</span>, <span class="va">Titanicp</span><span class="op">$</span><span class="va">parch</span><span class="op">)</span></span>
<span><span class="co">##    </span></span>
<span><span class="co">##       0   1   2   3   4   5   6   9</span></span>
<span><span class="co">##   0 790  52  43   2   2   2   0   0</span></span>
<span><span class="co">##   1 183  90  29   5   4   4   2   2</span></span>
<span><span class="co">##   2  26   9   6   1   0   0   0   0</span></span>
<span><span class="co">##   3   3   9   8   0   0   0   0   0</span></span>
<span><span class="co">##   4   0  10  12   0   0   0   0   0</span></span>
<span><span class="co">##   5   0   0   6   0   0   0   0   0</span></span>
<span><span class="co">##   8   0   0   9   0   0   0   0   0</span></span></code></pre></div>
<p>For purposes of analysis, we might want to collapse both of these to
the levels <code>0, 1, 2+</code>. Here’s how:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">Titanicp</span> <span class="op">&lt;-</span> <span class="va">Titanicp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sibspF <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">sibsp</span>,</span>
<span>                            <span class="fl">0</span> <span class="op">~</span> <span class="st">"0"</span>,</span>
<span>                            <span class="fl">1</span> <span class="op">~</span> <span class="st">"1"</span>,</span>
<span>                            <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sibsp</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sibspF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">sibspF</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parchF <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">parch</span>,</span>
<span>                             <span class="fl">0</span> <span class="op">~</span> <span class="st">"0"</span>,</span>
<span>                             <span class="fl">1</span> <span class="op">~</span> <span class="st">"1"</span>,</span>
<span>                             <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">parch</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parchF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">parchF</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Titanicp</span><span class="op">$</span><span class="va">sibspF</span>, <span class="va">Titanicp</span><span class="op">$</span><span class="va">parchF</span><span class="op">)</span></span>
<span><span class="co">##     </span></span>
<span><span class="co">##        0   1  2+</span></span>
<span><span class="co">##   0  790  52  49</span></span>
<span><span class="co">##   1  183  90  46</span></span>
<span><span class="co">##   2+  29  28  42</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/car/man/recode.html" class="external-link">car::recode()</a></code> is a similar function, but with a less
convenient interface.</p>
<p>The <a href="https://CRAN.R-project.org/package=forcats" class="external-link"><code>forcats</code></a>
package provides a collection of functions for reordering the levels of
a factor or grouping categories according to their frequency:</p>
<ul>
<li>
<code><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">forcats::fct_reorder()</a></code>: Reorder a factor by another
variable.</li>
<li>
<code><a href="https://forcats.tidyverse.org/reference/fct_inorder.html" class="external-link">forcats::fct_infreq()</a></code>: Reorder a factor by the
frequency of values.</li>
<li>
<code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">forcats::fct_relevel()</a></code>: Change the order of a factor by
hand.</li>
<li>
<code><a href="https://forcats.tidyverse.org/reference/fct_lump.html" class="external-link">forcats::fct_lump()</a></code>: Collapse the least/most frequent
values of a factor into “other”.</li>
<li>
<code><a href="https://forcats.tidyverse.org/reference/fct_collapse.html" class="external-link">forcats::fct_collapse()</a></code>: Collapse factor levels into
manually defined groups.</li>
<li>
<code><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">forcats::fct_recode()</a></code>: Change factor levels by
hand.</li>
</ul>
</div>
<div class="section level3">
<h3 id="converting-among-frequency-tables-and-data-frames">Converting among frequency tables and data frames<a class="anchor" aria-label="anchor" href="#converting-among-frequency-tables-and-data-frames"></a>
</h3>
<p>As we’ve seen, a given contingency table can be represented
equivalently in different forms, but some R functions were designed for
one particular representation.</p>
<p>The table below shows some handy tools for converting from one form
to another.</p>
<!-- [htb] -->
<!--  \caption{Tools for converting among different forms for categorical data} {#tab:convert} -->
<!--    {llll} -->
<!--    \hline -->
<!--                  & \multicolumn{3}{c}{**To this**} \\ -->
<!--    **From this**      &     Case form         & Frequency form             &  Table form \\ -->
<!--    \hline -->
<!--    Case form      &   noop                 & `xtabs(~A+B)`        &  `table(A,B)`  \\  -->
<!--    Frequency form &  `expand.dft(X)`  & noop                      & `xtabs(count~A+B)`\\ -->
<!--    Table form     &  `expand.dft(X)`  & `as.data.frame(X)`   &  noop \\ -->
<!--    \hline -->
<table class="table">
<colgroup>
<col width="22%">
<col width="26%">
<col width="27%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left"><strong>From this</strong></th>
<th align="left"></th>
<th align="left"><strong>To this</strong></th>
<th></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left"><em>Case form</em></td>
<td align="left"><em>Frequency form</em></td>
<td><em>Table form</em></td>
</tr>
<tr class="even">
<td align="left"><em>Case form</em></td>
<td align="left">noop</td>
<td align="left"><code>xtabs(~A+B)</code></td>
<td><code>table(A,B)</code></td>
</tr>
<tr class="odd">
<td align="left"><em>Frequency form</em></td>
<td align="left"><code>expand.dft(X)</code></td>
<td align="left">noop</td>
<td><code>xtabs(count~A+B)</code></td>
</tr>
<tr class="even">
<td align="left"><em>Table form</em></td>
<td align="left"><code>expand.dft(X)</code></td>
<td align="left"><code>as.data.frame(X)</code></td>
<td>noop</td>
</tr>
</tbody>
</table>
<p>For example, a contingency table in table form (an object of
<code>class(table)</code>) can be converted to a data.frame with
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code>. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Because R is object-oriented, this is actually a
short-hand for the function &lt;code&gt;&lt;a href="https://rdrr.io/r/base/table.html" class="external-link"&gt;as.data.frame.table()&lt;/a&gt;&lt;/code&gt;.&lt;/p&gt;'><sup>2</sup></a> The resulting <code>data.frame</code>
contains columns representing the classifying factors and the table
entries (as a column named by the <code>responseName</code> argument,
defaulting to <code>Freq</code>. This is the inverse of
<code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>.</p>
<p><strong><em>Example</em></strong>: Convert the <code>GSStab</code> in
table form to a data.frame in frequency form.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">GSStab</span><span class="op">)</span></span>
<span><span class="co">##      sex party Freq</span></span>
<span><span class="co">## 1 female   dem  279</span></span>
<span><span class="co">## 2   male   dem  165</span></span>
<span><span class="co">## 3 female indep   73</span></span>
<span><span class="co">## 4   male indep   47</span></span>
<span><span class="co">## 5 female   rep  225</span></span>
<span><span class="co">## 6   male   rep  191</span></span></code></pre></div>
<p><strong><em>Example</em></strong>: Convert the <code>Arthritis</code>
data in case form to a 3-way table of <code>Treatment</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math><code>Sex</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math><code>Improved</code>. Note the use of <code><a href="https://rdrr.io/r/base/with.html" class="external-link">with()</a></code> to avoid
having to use <code>Arthritis\$Treatment</code> etc. within the call to
<code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code>.% <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;&lt;a href="https://rdrr.io/r/base/table.html" class="external-link"&gt;table()&lt;/a&gt;&lt;/code&gt; does not allow a &lt;code&gt;data&lt;/code&gt;
argument to provide an environment in which the table variables are to
be found. In the examples in @ref(sec:table) I used
&lt;code&gt;attach(mydata)&lt;/code&gt; for this purpose, but &lt;code&gt;&lt;a href="https://rdrr.io/r/base/attach.html" class="external-link"&gt;attach()&lt;/a&gt;&lt;/code&gt;
leaves the variables in the global environment, while
&lt;code&gt;&lt;a href="https://rdrr.io/r/base/with.html" class="external-link"&gt;with()&lt;/a&gt;&lt;/code&gt; just evaluates the &lt;code&gt;&lt;a href="https://rdrr.io/r/base/table.html" class="external-link"&gt;table()&lt;/a&gt;&lt;/code&gt; expression
in a temporary environment of the data.&lt;/p&gt;'><sup>3</sup></a></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Art.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Arthritis</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Treatment</span>, <span class="va">Sex</span>, <span class="va">Improved</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Art.tab</span><span class="op">)</span></span>
<span><span class="co">##  'table' int [1:2, 1:2, 1:3] 19 6 10 7 7 5 0 2 6 16 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 3</span></span>
<span><span class="co">##   ..$ Treatment: chr [1:2] "Placebo" "Treated"</span></span>
<span><span class="co">##   ..$ Sex      : chr [1:2] "Female" "Male"</span></span>
<span><span class="co">##   ..$ Improved : chr [1:3] "None" "Some" "Marked"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/ftable.html" class="external-link">ftable</a></span><span class="op">(</span><span class="va">Art.tab</span><span class="op">)</span></span>
<span><span class="co">##                  Improved None Some Marked</span></span>
<span><span class="co">## Treatment Sex                             </span></span>
<span><span class="co">## Placebo   Female            19    7      6</span></span>
<span><span class="co">##           Male              10    0      1</span></span>
<span><span class="co">## Treated   Female             6    5     16</span></span>
<span><span class="co">##           Male               7    2      5</span></span></code></pre></div>
<p>There may also be times that you will need an equivalent case form
<code>data.frame</code> with factors representing the table variables
rather than the frequency table. For example, the <code><a href="https://rdrr.io/pkg/MASS/man/mca.html" class="external-link">mca()</a></code>
function in package <code>MASS</code> only operates on data in this
format. Marc Schwartz initially provided code for
<code><a href="../reference/expand.dft.html">expand.dft()</a></code> on the Rhelp mailing list for converting a
table back into a case form <code>data.frame</code>. This function is
included in <code>vcdExtra</code>.</p>
<p><strong><em>Example</em></strong>: Convert the <code>Arthritis</code>
data in table form (<code>Art.tab</code>) back to a
<code>data.frame</code> in case form, with factors
<code>Treatment</code>, <code>Sex</code> and <code>Improved</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Art.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/expand.dft.html">expand.dft</a></span><span class="op">(</span><span class="va">Art.tab</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Art.df</span><span class="op">)</span></span>
<span><span class="co">## 'data.frame':    84 obs. of  3 variables:</span></span>
<span><span class="co">##  $ Treatment: chr  "Placebo" "Placebo" "Placebo" "Placebo" ...</span></span>
<span><span class="co">##  $ Sex      : chr  "Female" "Female" "Female" "Female" ...</span></span>
<span><span class="co">##  $ Improved : chr  "None" "None" "None" "None" ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sec:complex">A complex example<a class="anchor" aria-label="anchor" href="#sec:complex"></a>
</h3>
<p>If you’ve followed so far, you’re ready for a more complicated
example. The data file, <code>tv.dat</code> represents a 4-way table of
size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>×</mo><mn>11</mn><mo>×</mo><mn>5</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">5 \times 11 \times 5 \times 3</annotation></semantics></math>
where the table variables (unnamed in the file) are read as
<code>V1</code> – <code>V4</code>, and the cell frequency is read as
<code>V5</code>. The file, stored in the <code>doc/extdata</code>
directory of <code>vcdExtra</code>, can be read as follows:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tv.data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"tv.dat"</span>, package<span class="op">=</span><span class="st">"vcdExtra"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tv.data</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">##   V1 V2 V3 V4 V5</span></span>
<span><span class="co">## 1  1  1  1  1  6</span></span>
<span><span class="co">## 2  2  1  1  1 18</span></span>
<span><span class="co">## 3  3  1  1  1  6</span></span>
<span><span class="co">## 4  4  1  1  1  2</span></span>
<span><span class="co">## 5  5  1  1  1 11</span></span></code></pre></div>
<p>For a local file, just use <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table()</a></code> in this
form:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tv.data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"C:/R/data/tv.dat"</span><span class="op">)</span></span></code></pre></div>
<p>The data <code>tv.dat</code> came from the initial implementation of
mosaic displays in R by Jay Emerson. In turn, they came from the initial
development of mosaic displays <span class="citation">(Hartigan &amp;
Kleiner, 1984)</span> that illustrated the method with data on a large
sample of TV viewers whose behavior had been recorded for the Neilsen
ratings. This data set contains sample television audience data from
Neilsen Media Research for the week starting November 6, 1995.</p>
<p>The table variables are:</p>
<ul>
<li>
<code>V1</code>– values 1:5 correspond to the days
Monday–Friday;</li>
<li>
<code>V2</code>– values 1:11 correspond to the quarter hour times
8:00PM through 10:30PM;</li>
<li>
<code>V3</code>– values 1:5 correspond to ABC, CBS, NBC, Fox, and
non-network choices;</li>
<li>
<code>V4</code>– values 1:3 correspond to transition states: turn
the television Off, Switch channels, or Persist in viewing the current
channel.</li>
</ul>
<p>We are interested just the cell frequencies, and rely on the facts
that the</p>
<ol style="list-style-type: lower-alpha">
<li>the table is complete— there are no missing cells, so
<code>nrow(tv.data)</code> = 825;</li>
<li>the observations are ordered so that <code>V1</code> varies most
rapidly and <code>V4</code> most slowly. From this, we can just extract
the frequency column and reshape it into an array. [That would be
dangerous if any observations were out of order.]</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">tv.data</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">11</span>,<span class="fl">5</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>                                        </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">TV</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Monday"</span>,<span class="st">"Tuesday"</span>,<span class="st">"Wednesday"</span>,<span class="st">"Thursday"</span>,<span class="st">"Friday"</span><span class="op">)</span>, </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"8:00"</span>,<span class="st">"8:15"</span>,<span class="st">"8:30"</span>,<span class="st">"8:45"</span>,<span class="st">"9:00"</span>,<span class="st">"9:15"</span>,<span class="st">"9:30"</span>,         </span>
<span>                       <span class="st">"9:45"</span>,<span class="st">"10:00"</span>,<span class="st">"10:15"</span>,<span class="st">"10:30"</span><span class="op">)</span>,                            </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ABC"</span>,<span class="st">"CBS"</span>,<span class="st">"NBC"</span>,<span class="st">"Fox"</span>,<span class="st">"Other"</span><span class="op">)</span>, </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Off"</span>,<span class="st">"Switch"</span>,<span class="st">"Persist"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">TV</span><span class="op">)</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Time"</span>, <span class="st">"Network"</span>, <span class="st">"State"</span><span class="op">)</span></span></code></pre></div>
<p>More generally (even if there are missing cells), we can use
<code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code> (or <code><a href="https://rdrr.io/pkg/plyr/man/daply.html" class="external-link">plyr::daply()</a></code>) to do the
cross-tabulation, using <code>V5</code> as the frequency variable.
Here’s how to do this same operation with <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">V5</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">tv.data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">TV</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Monday"</span>,<span class="st">"Tuesday"</span>,<span class="st">"Wednesday"</span>,<span class="st">"Thursday"</span>,<span class="st">"Friday"</span><span class="op">)</span>, </span>
<span>                     Time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"8:00"</span>,<span class="st">"8:15"</span>,<span class="st">"8:30"</span>,<span class="st">"8:45"</span>,<span class="st">"9:00"</span>,<span class="st">"9:15"</span>,<span class="st">"9:30"</span>,         </span>
<span>                              <span class="st">"9:45"</span>,<span class="st">"10:00"</span>,<span class="st">"10:15"</span>,<span class="st">"10:30"</span><span class="op">)</span>,                            </span>
<span>                     Network <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ABC"</span>,<span class="st">"CBS"</span>,<span class="st">"NBC"</span>,<span class="st">"Fox"</span>,<span class="st">"Other"</span><span class="op">)</span>, </span>
<span>                     State <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Off"</span>,<span class="st">"Switch"</span>,<span class="st">"Persist"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># table dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">TV</span><span class="op">)</span></span></code></pre></div>
<p>But this 4-way table is too large and awkward to work with. Among the
networks, Fox and Other occur infrequently. We can also cut it down to a
3-way table by considering only viewers who persist with the current
station. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This relies on the fact that that indexing an array
drops dimensions of length 1 by default, using the argument
&lt;code&gt;drop=TRUE&lt;/code&gt;; the result is coerced to the lowest possible
dimension.&lt;/p&gt;"><sup>4</sup></a></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TV2</span> <span class="op">&lt;-</span> <span class="va">TV</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span>      <span class="co"># keep only ABC, CBS, NBC</span></span>
<span><span class="va">TV2</span> <span class="op">&lt;-</span> <span class="va">TV2</span><span class="op">[</span>,,,<span class="fl">3</span><span class="op">]</span>       <span class="co"># keep only Persist -- now a 3 way table</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">TV2</span><span class="op">)</span></span>
<span><span class="co">##                   Time 8:00 8:15 8:30 8:45 9:00 9:15 9:30 9:45 10:00 10:15 10:30</span></span>
<span><span class="co">## Day       Network                                                               </span></span>
<span><span class="co">## Monday    ABC           146  151  156   83  325  350  386  340   352   280   278</span></span>
<span><span class="co">##           CBS           337  293  304  233  311  251  241  164   252   265   272</span></span>
<span><span class="co">##           NBC           263  219  236  140  226  235  239  246   279   263   283</span></span>
<span><span class="co">## Tuesday   ABC           244  181  231  205  385  283  345  192   329   351   364</span></span>
<span><span class="co">##           CBS           173  180  184  109  218  235  256  250   274   263   261</span></span>
<span><span class="co">##           NBC           315  254  280  241  370  214  195  111   188   190   210</span></span>
<span><span class="co">## Wednesday ABC           233  161  194  156  339  264  279  140   237   228   203</span></span>
<span><span class="co">##           CBS           158  126  207   59   98  103  122   86   109   105   110</span></span>
<span><span class="co">##           NBC           134  146  166   66  194  230  264  143   274   289   306</span></span>
<span><span class="co">## Thursday  ABC           174  183  197  181  187  198  211   86   110   122   117</span></span>
<span><span class="co">##           CBS           196  185  195  104  106  116  116   47   102    84    84</span></span>
<span><span class="co">##           NBC           515  463  472  477  590  473  446  349   649   705   747</span></span>
<span><span class="co">## Friday    ABC           294  281  305  239  278  246  245  138   246   232   233</span></span>
<span><span class="co">##           CBS           130  144  154   81  129  153  136  126   138   136   152</span></span>
<span><span class="co">##           NBC           195  220  248  160  172  164  169   85   183   198   204</span></span></code></pre></div>
<p>Finally, for some purposes, we might want to collapse the 11 times
into a smaller number. Half-hour time slots make more sense. Here, we
use <code><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table()</a></code> to convert the table back to a
data frame, <code><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels()</a></code> to re-assign the values of
<code>Time</code>, and finally, <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs()</a></code> to give a new,
collapsed frequency table.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TV.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">as.data.frame.table</a></span><span class="op">(</span><span class="va">TV2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">TV.df</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"8:00"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"8:30"</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"9:00"</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"9:30"</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"10:00"</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                            <span class="st">"10:30"</span></span>
<span>                        <span class="op">)</span></span>
<span></span>
<span><span class="va">TV3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></span><span class="op">(</span><span class="va">Freq</span> <span class="op">~</span> <span class="va">Day</span> <span class="op">+</span> <span class="va">Time</span> <span class="op">+</span> <span class="va">Network</span>, <span class="va">TV.df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/structable.html" class="external-link">structable</a></span><span class="op">(</span><span class="va">Day</span> <span class="op">~</span> <span class="va">Time</span><span class="op">+</span><span class="va">Network</span>, <span class="va">TV3</span><span class="op">)</span></span>
<span><span class="co">##               Day Monday Tuesday Wednesday Thursday Friday</span></span>
<span><span class="co">## Time  Network                                             </span></span>
<span><span class="co">## 8:00  ABC            297     425       394      357    575</span></span>
<span><span class="co">##       CBS            630     353       284      381    274</span></span>
<span><span class="co">##       NBC            482     569       280      978    415</span></span>
<span><span class="co">## 8:30  ABC            239     436       350      378    544</span></span>
<span><span class="co">##       CBS            537     293       266      299    235</span></span>
<span><span class="co">##       NBC            376     521       232      949    408</span></span>
<span><span class="co">## 9:00  ABC            675     668       603      385    524</span></span>
<span><span class="co">##       CBS            562     453       201      222    282</span></span>
<span><span class="co">##       NBC            461     584       424     1063    336</span></span>
<span><span class="co">## 9:30  ABC            726     537       419      297    383</span></span>
<span><span class="co">##       CBS            405     506       208      163    262</span></span>
<span><span class="co">##       NBC            485     306       407      795    254</span></span>
<span><span class="co">## 10:00 ABC            632     680       465      232    478</span></span>
<span><span class="co">##       CBS            517     537       214      186    274</span></span>
<span><span class="co">##       NBC            542     378       563     1354    381</span></span>
<span><span class="co">## 10:30 ABC            278     364       203      117    233</span></span>
<span><span class="co">##       CBS            272     261       110       84    152</span></span>
<span><span class="co">##       NBC            283     210       306      747    204</span></span></code></pre></div>
<p>We’ve come this far, so we might as well show a mosaic display. This
is analogous to that used by <span class="citation">Hartigan &amp;
Kleiner (1984)</span>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/vcd/man/mosaic.html" class="external-link">mosaic</a></span><span class="op">(</span><span class="va">TV3</span>, shade <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       labeling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/vcd/man/labeling_border.html" class="external-link">labeling_border</a></span><span class="op">(</span>rot_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="a1-creating_files/figure-html/tv-mosaic1-1.png" class="r-plt" width="672"></p>
<p>This mosaic displays can be read at several levels, corresponding to
the successive splits of the tiles and the residual shading. Several
trends are clear for viewers who persist:</p>
<ul>
<li>Overall, there are about the same number of viewers on each weekday,
with slightly more on Thursday.</li>
<li>Looking at time slots, viewership is slightly greater from 9:00 -
10:00 overall and also 8:00 - 9:00 on Thursday and Friday</li>
</ul>
<p>From the residual shading of the tiles:</p>
<ul>
<li>Monday: CBS dominates in all time slots.</li>
<li>Tuesday” ABC and CBS dominate after 9:00</li>
<li>Thursday: is a largely NBC day</li>
<li>Friday: ABC dominates in the early evening</li>
</ul>
<!-- ```{r, tv4} --><!-- TV.df <- as.data.frame.table(TV) --><!-- levels(TV.df$Time) <- c(rep("8:00-8:59",4), --><!--                         rep("9:00-9:59",4),  --><!--                         rep("10:00-10:44",3)) --><!-- TV3 <- xtabs(Freq ~ Day + Time + Network, TV.df) --><!-- structable(Day ~ Time+Network, TV3) --><!-- ``` --><!-- Whew! See \figref{fig:TV-mosaic} for a mosaic plot of the `TV3` data. --><!-- The table is too large to display conveniently, but we can show a subtable --><!-- by selecting the indices.  This call to `ftable()` subsets the first three --><!-- levels of each factor. --><!-- ```{r tv4} --><!-- ftable(TV[1:3,1:3,1:3,1:3], col.vars = 3:4) --><!-- ``` --><!-- We've come this far, so we might as well show a mosaic display. This is analogous to that used by --><!-- @vcd:Hartigan+Kleiner:1984. The result is too complex to see very much.  It would be useful to simplify --><!-- the table by collapsing one or more of the table dimensions, e.g., `Time`. --><!-- ```{r tv-mosaic2, fig.height=7, fig.width=7} --><!-- mosaic(TV[,,1:4,], shade=TRUE,  --><!--        labeling_args = list(abbreviate_labs = c(8,5,1,1))) --><!-- ``` -->
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-vcd:Agresti:2002" class="csl-entry">
Agresti, A. (2002). <em>Categorical data analysis</em> (2nd ed.).
Hoboken, New Jersey: John Wiley &amp; Sons.
</div>
<div id="ref-vcd:Hartigan+Kleiner:1984" class="csl-entry">
Hartigan, J. A., &amp; Kleiner, B. (1984). A mosaic of television
ratings. <em>The American Statistician</em>, <em>38</em>, 32–35.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Friendly.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
