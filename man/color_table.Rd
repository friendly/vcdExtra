% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/color_table.R
\name{color_table}
\alias{color_table}
\alias{color_table.table}
\alias{color_table.ftable}
\alias{color_table.structable}
\alias{color_table.data.frame}
\alias{color_table.matrix}
\alias{color_table.default}
\title{Display Frequency Table with Colored Cell Backgrounds}
\usage{
color_table(x, ...)

\method{color_table}{table}(
  x,
  formula = NULL,
  shade = c("residuals", "freq", "pearson", "deviance"),
  model = NULL,
  expected = NULL,
  palette = NULL,
  legend = TRUE,
  margins = TRUE,
  digits = 0,
  title = NULL,
  filename = NULL,
  ...
)

\method{color_table}{ftable}(
  x,
  shade = c("residuals", "freq", "pearson", "deviance"),
  model = NULL,
  expected = NULL,
  palette = NULL,
  legend = TRUE,
  margins = TRUE,
  digits = 0,
  title = NULL,
  filename = NULL,
  ...
)

\method{color_table}{structable}(
  x,
  shade = c("residuals", "freq", "pearson", "deviance"),
  model = NULL,
  expected = NULL,
  palette = NULL,
  legend = TRUE,
  margins = TRUE,
  digits = 0,
  title = NULL,
  filename = NULL,
  ...
)

\method{color_table}{data.frame}(
  x,
  formula = NULL,
  freq_col = NULL,
  shade = c("residuals", "freq", "pearson", "deviance"),
  model = NULL,
  expected = NULL,
  palette = NULL,
  legend = TRUE,
  margins = TRUE,
  digits = 0,
  title = NULL,
  filename = NULL,
  ...
)

\method{color_table}{matrix}(
  x,
  shade = c("residuals", "freq", "pearson", "deviance"),
  model = NULL,
  expected = NULL,
  palette = NULL,
  legend = TRUE,
  margins = TRUE,
  digits = 0,
  title = NULL,
  filename = NULL,
  ...
)

\method{color_table}{default}(x, ...)
}
\arguments{
\item{x}{A table, xtabs, matrix, ftable, structable, or data.frame object}

\item{...}{Additional arguments passed to methods}

\item{formula}{Formula specifying row ~ col layout (for multi-way tables)}

\item{shade}{What values determine cell shading: "residuals" (default), "freq",
"pearson", or "deviance"}

\item{model}{A fitted model (loglm or glm) to compute residuals from.
If NULL and shade involves residuals, uses independence model.}

\item{expected}{Expected frequencies (alternative to model)}

\item{palette}{Color palette function or vector. Default depends on shade type.}

\item{legend}{Logical, show color legend/scale?}

\item{margins}{Logical, include row/column totals?}

\item{digits}{Number of decimal places for displayed values}

\item{title}{Optional table title}

\item{filename}{Optional filename to save the table as an image. If provided,
the table is saved using \code{\link[gt]{gtsave}}. Supported formats include
\code{.png}, \code{.svg}, \code{.pdf}, \code{.html}, \code{.rtf}, and \code{.docx}.
The format is determined by the file extension.}

\item{freq_col}{Name of the frequency column. If NULL, looks for "Freq" or "count".}
}
\value{
A gt table object that can be further customized
}
\description{
Creates a formatted table display of frequency data with cell backgrounds
colored according to observed frequencies or their residuals from a loglinear model.
This is an S3 generic function with methods for different input types.
}
\details{
This function provides a heatmap-style representation of a frequency table,
where background coloring is used to visualize patterns and anomalies in the data.
When shading by residuals (the default), cells with large positive residuals
(more observations than expected) are shaded red, while cells with large negative
residuals (fewer than expected) are shaded blue. This makes it easy to identify
cells that deviate substantially from what would be expected under a given model
(by default, the independence model).

For cells with dark background colors, black text can be difficult to read.
This function automatically selects white or black text for each cell based
on which provides better contrast against the background color. If the
\pkg{colorspace} package is available, \code{\link[colorspace]{contrast_ratio}}
is used to determine the optimal text color according to WCAG 2.1 guidelines.
Otherwise, a fallback based on relative luminance (ITU-R BT.709) is used.

In R Markdown (\code{.Rmd}) or Quarto (\code{.qmd}) documents, \pkg{gt} tables
may not render correctly in all output formats. The \code{filename} argument
provides a workaround: save the table as an image, then include it using
\code{\link[knitr]{include_graphics}}. For example:

\preformatted{
color_table(my_table, filename = "my_table.png")
knitr::include_graphics("my_table.png")
}

For higher quality output, \code{.svg} format is recommended. You can control
the image dimensions using the \code{vwidth} and \code{vheight} arguments
(passed via \code{...}).
}
\section{Methods (by class)}{
\itemize{
\item \code{color_table(table)}: Method for table objects (including xtabs)

\item \code{color_table(ftable)}: Method for ftable objects

\item \code{color_table(structable)}: Method for structable objects (vcd package)

\item \code{color_table(data.frame)}: Method for data.frame in frequency form

\item \code{color_table(matrix)}: Method for matrix objects

\item \code{color_table(default)}: Default method

}}
\examples{
\dontrun{
# Basic usage - shade by residuals from independence
data(HairEyeColor)
HEC <- margin.table(HairEyeColor, 2:1)
color_table(HEC)

# Shade by frequencies instead
color_table(HEC, shade = "freq")

# 3-way table with formula
color_table(HairEyeColor, formula = Eye ~ Hair + Sex)

# From a data.frame in frequency form
hec_df <- as.data.frame(HEC)
color_table(hec_df)

# Save table as an image file
color_table(HEC, filename = "hair_eye_table.png")
color_table(HEC, filename = "hair_eye_table.svg", vwidth = 600)
}

}
